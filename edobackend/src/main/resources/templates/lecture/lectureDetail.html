<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/headAndFootLayout}">
<head>
    <link rel="stylesheet" type="text/css" href="/css/lectureDetail.css">
    <link rel="stylesheet" type="text/css" href="/css/btnDesign.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
    <meta charset="utf-8">
</head>
<body>
<div layout:fragment="content">
    <div th:if="${not #strings.isEmpty(lecture)}">
        <div class="row ">
            <div class="col-sm-3 top-box-img" style="margin-left: 100px;">
                <img th:src="'/image/'+${lecture.getLectureImage()}" class="div_inner" alt="/img/project-1.jpg"/>
            </div>
            <div class="col top-box-info">
                <a class="btn blue mini" th:text="${lecture.getLecturePart()}"/>
                <h4 th:text="${lecture.getLectureTitle()}"></h4>
                <br>
                <span th:text="${lecture.getLectureDetail()}"></span>
                <br>
                <b class="top-box-teacher">아무개</b>
                <div class="top-box-bottom">
                    <a id="btnTest"><i class="bi bi-suit-heart" id="test"></i></a>
                    <span>(1024)</span>
                    |
                    <a class="btn red mini">구독</a>
                </div>
            </div>
        </div>
        <hr>
        <div class="row margin-top " style="width: 80%; margin: auto;">
            <div class="col-sm-12 block-contain">
                <div class="row">
                    <div class="col-sm-10 col-md-10">
                        <div class="row">
                            <div class="row">
                                <h2>강의 소개</h2>
                                <div class="form-group">
                                    <div id="lectureInfo">
                                        <dd th:utext="${lecture.getLectureInfo()}"></dd>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3 top-box-img" style="margin-left: 100px;">
                                <img src="/image/teacherImg.png"  alt="/img/project-1.jpg"/>
                            </div>
                            <div class="col top-box-info">
                                <h4>아무개</h4>
                                <br>
                                <span>강사 소개</span>
                                <br>
                                <ol>
                                   <li>스펙1</li>
                                    <li>스펙2</li>
                                    <li>스펙3</li>
                                    <li>스펙4</li>
                                    <li>스펙5</li>
                                </ol>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div th:if="${not #strings.isEmpty(lectureDivide)}">
                                <p style="font-weight: 2000; font-size: 20px;">목차</p>
                                <div th:each="vo,status : ${lectureDivide}">
                                    <div class="accordion" id="accordionPanelsStayOpenExample">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header"
                                                th:id="'panelsStayOpen-heading'+${status.count}">
                                                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                                        th:data-bs-target="'#panelsStayOpen-collapse'+${status.count}"
                                                        aria-expanded="true"
                                                        th:aria-controls="'panelsStayOpen-collapse'+${status.count}"
                                                        th:text="'강의'+${status.count}">
                                                </button>
                                            </h2>
                                            <div th:id="'panelsStayOpen-collapse'+${status.count}"
                                                 class="accordion-collapse collapse"
                                                 th:aria-labelledby="'panelsStayOpen-heading'+${status.count}">
                                                <div class="accordion-body">
                                                    <p style="font-weight: 1000;">강의 제목</p>
                                                    <p th:text="${vo.getLectureDivideTitle()}"></p>
                                                    <br>
                                                    <p style="font-weight: 1000;">강의 설명</p>
                                                    <dd th:utext="${vo.getLectureDivideInfo()}"></dd>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2 col-md-2">
                        <div th:if="${lectureDivide.size()>0}">
                            <div class="side-box" id="scroll">
                                <h4>사이드 박스</h4>
                                <div class="row">
                                    <div class="col">
                                        <a th:href="'/lecture/contents/'+${lecture.getId()}+'/'+${lectureDivide.get(0).getId()}">강의
                                            듣기</a>
                                    </div>
                                    <div class="col" sec:authorize="isAuthenticated()">
                                        <a>강의 관리</a>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <a th:href="'/lecture/All'">목록</a>
                                    </div>
                                    <div class="col" sec:authorize="isAuthenticated()">
                                        <a th:href="'/lecture/contents/'+${lecture.getId()}+'/'+${lectureDivide.get(0).getId()}">강의
                                            삭제</a>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(window).scroll(function () {
            var position = $(document).scrollTop();
            $("#scroll").css('top', position);
        });
    </script>
    <script type="text/javascript">
        $("#uploadLecture").submit(function (event) {
            event.preventDefault();
            $("#lectureInfoHidden").val(editor[0].getData());
            this.submit();
        });
    </script>
    <script>

        ClassicEditor
            .create(document.querySelector('#lectureInfo'))
            .catch(error => {
                console.error(error);
            });
    </script>
    <!--heart 버튼 클릭 시 온 오프 및 데이터 저장-->

    <script type="text/javascript">
        //ready(function)을 통해 시작 시  heart 값이 1이면 좋아요가 눌러진 상태, 0이면 좋아요가 안 눌러진 상태
        $(document).ready(function () {
            var heart = document.getElementById('heart').value;
            var type = document.getElementById('test').className;
            if (heart == 1) {
                document.getElementById('test').className = 'bi bi-suit-heart-fill';

            } else {
                document.getElementById('test').className = 'bi bi-suit-heart';

            }

        });

        //하트 버튼 클릭 시
        $('#btnTest').on('click', function (e) {
            var type = document.getElementById('test').className;
            var id = document.getElementById('id').value;
            //좋아요가 눌러진 상태에서 한 번 더 누른다면
            if (type == 'bi bi-suit-heart-fill') {
                var heart = 0;
                //className을 bi bi-suit-heart로 변경 해 좋아요가 안눌러진 그림으로
                document.getElementById('test').className = 'bi bi-suit-heart';
                //ajax 처리를 통해 communityController의 comheart 호출(좋아요 상태를 db에 전달)
                $.ajax({
                    url: "/community/comheart",
                    type: "post",
                    data: {
                        id: id,
                        heart: heart,
                    }
                })
            } else {
                var heart = 1;
                document.getElementById('test').className = 'bi bi-suit-heart-fill';
                $.ajax({
                    url: "/community/comheart",
                    type: "post",
                    data: {
                        id: id,
                        heart: heart,
                    }
                })
            }
        });
    </script>
</div>

</body>

</html>