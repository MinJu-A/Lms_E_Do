<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/basiclayout}">
<head>
    <title>커뮤니티</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link th:rel="stylesheet" th:href="@{/assets/dropzonejs/dropzone.css}"/>
    <link th:rel="stylesheet" th:href="@{/assets/toastr/toastr.min.css}"/>
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"/>
    <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
    <link rel="stylesheet" type="text/css"
          href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.ckeditor.com/ckeditor5/35.1.0/classic/ckeditor.js"></script>


    <link rel="stylesheet" type="text/css" href="/css/footer.css">
    <link rel="stylesheet" type="text/css" href="/css/header.css">
    <link rel="stylesheet" type="text/css" href="/css/community.css">

    <script>
        if (top != window) {
            top.location = window.location;
        }
    </script>

</head>
<body class="vsc-initialized">
<div layout:fragment="content">
    <div id="wraper">
        <!--  community field  -->
        <div id="container">

            <h3><img th:src="@{/img/}+'EDoLOGO_small.png'" width="30px" height="30px"><b>글 작성하기</b></h3>

            <form role="form" method="post" enctype="multipart/form-data" id="formId" th:object="${communityDto}">
                <div style="display:block;">
<!--                    현재 로그인 한 사용자의 이름을 받아올 것.-->
                    <input type="hidden" th:field="*{communityNickname}" name="communityNickname" id="communityNickname"/>
                    <label>구분</label>
                    <select name="section">
                        <option value="NOTICE">공지</option>
                        <option value="QNA">Q&A</option>
                        <option value="FREE">자유게시판</option>
                        <option value="SHORT">쇼츠</option>
                    </select>

                    <br>
                    <label>제목</label>
                    <input type="text" th:field="*{communityTitle}" name="communityTitle" id="communityTitle"></input>
                </div>
                <!--        파일 업로드 부분 -->
                <!--        <div style="display: block">-->
                <!--            <label>파일 업로드</label>-->
                <!--            <form action="/upload" method="post" class="dropzone"-->
                <!--                  enctype="multipart/form-data" >-->
                <!--                <div id="fileDropzone">-->
                <!--                    <div class="dz-message needsclick">-->
                <!--                        Dropfiles here or click to upload.-->
                <!--                    </div>-->
                <!--                </div>-->
                <!--            </form>`-->
                <!--            <div class="form-group">-->
                <div style="display:block;">
                    <label class="form-label mt-4"> 내용 </label>
                    <!--                    민주 코드-->
                    <!--                <input type = textarea name="content" id="editor1" th:field="*{communityContents}">-->
                    <!--                    형준 코드-->
                    <textarea name="communityContents" id="editor1">
            &lt;p&gt;This is some sample content.&lt;/p&gt;
        </textarea>
                    </input>
                </div>
                <div style="display:block;">
                    <div align="center" style="margin-top: 10px">
                        <input type=submit value="등록" class="btn btn-secondary" id="nextButton"
                               th:formaction="@{/community/write}"/>
                    </div>
                </div>

            </form>


        </div>
    </div>


    <script>
        let editor;
        ClassicEditor
            .create(document.querySelector('#editor1'))
            .then(newEditor => {
                editor = newEditor;
            })
            .catch(error => {
                console.error(error);
            });
    </script>
    <script>

        $(#formId).submit(function (event) {
            //자동 submit 시키는 것을 막음
            event.preventDefault();
            let communityTitle = $("#communityTitle").val();
            let communityDetail = [];
            communityDetail.push(editor.getData())
            let param = {
                "communityTitle": communityTitle,
                "communityContents": communityDetail
            }

            console.log(param)

            let isSubmit = false;

            $.ajax({
                async: false,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(param),
                url: "/community/write",
                dataType: "text",
                success: function (data) {
                    let message = "success";
                    alert('성공');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("ERROR : " + textStatus + " : " + errorThrown);
                }

            });
            if (message == "success") {
                this.submit();
            }


        });
    </script>
</div>

</body>

</html>